#!/usr/bin/env bash
# vim: ft=sh
set -e

NIMBUS_ETH1_DB_DIR="{{ nimbus_eth1_db_dir }}"
NIMBUS_ETH1_TEMPLATE_DB="{{ nimbus_eth1_template_db }}"
NIMBUS_ETH1_SERVICE_USER="{{ nimbus_eth1_service_user }}"
NIMBUS_ETH1_SERVICE_GROUP="{{ nimbus_eth1_service_group }}"

function log() {
   echo "$(date '+%Y-%m-%d %H:%M:%S') - $*"
}

function copyTemplateDatabase() {
  log ">>> starting copyTemplateDatabase()"

  # this path is generated by nimbus, however in case of short benchmark this path may get cleaned up
  log "mkdir -p ${NIMBUS_ETH1_DB_DIR}"
  mkdir -p "${NIMBUS_ETH1_DB_DIR}"

  log ">>> Copying template db into nimbus data directory"
  log "cp -r ${NIMBUS_ETH1_TEMPLATE_DB}/. $NIMBUS_ETH1_DB_DIR/"
  cp -r "${NIMBUS_ETH1_TEMPLATE_DB}/." "$NIMBUS_ETH1_DB_DIR/"

  log ">>> Template db copied"
  log "chown -R ${NIMBUS_ETH1_SERVICE_USER}:${NIMBUS_ETH1_SERVICE_GROUP} ${NIMBUS_ETH1_DB_DIR}"
  chown -R "${NIMBUS_ETH1_SERVICE_USER}:${NIMBUS_ETH1_SERVICE_GROUP}" "${NIMBUS_ETH1_DB_DIR}"

  log ">>> completed copyTemplateDatabase()"
}

copyTemplateDatabase


