#!/usr/bin/env bash
# vim: ft=sh
set -e

NIMBUS_ETH1_DB_DIR="{{ nimbus_eth1_db_dir }}"
NIMBUS_ETH1_TEMPLATE_DB="{{ nimbus_eth1_template_db }}"
NIMBUS_ETH1_SERVICE_USER="{{ nimbus_eth1_service_user }}"
NIMBUS_ETH1_SERVICE_GROUP="{{ nimbus_eth1_service_group }}"

function copyTemplateDatabase() {
  echo ">>> starting copyTemplateDatabase()"

  # this path is generated by nimbus, however in case of short benchmark this path may get cleaned up
  echo "mkdir -p ${NIMBUS_ETH1_DB_DIR}"
  mkdir -p "${NIMBUS_ETH1_DB_DIR}"

  echo ">>> Copying template db into nimbus data directory"
  echo "cp -r ${NIMBUS_ETH1_TEMPLATE_DB}/. $NIMBUS_ETH1_DB_DIR/"
  cp -r "${NIMBUS_ETH1_TEMPLATE_DB}/." "$NIMBUS_ETH1_DB_DIR/"

  echo ">>> Template db copied"
  echo "chown -R ${NIMBUS_ETH1_SERVICE_USER}:${NIMBUS_ETH1_SERVICE_GROUP} ${NIMBUS_ETH1_DB_DIR}"
  chown -R "${NIMBUS_ETH1_SERVICE_USER}:${NIMBUS_ETH1_SERVICE_GROUP}" "${NIMBUS_ETH1_DB_DIR}"

  echo ">>> completed copyTemplateDatabase()"
}

copyTemplateDatabase
